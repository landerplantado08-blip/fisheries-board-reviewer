<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCP Fisheries Board Reviewer (All-in-One)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root { --background: #f8fafc; --foreground: #020617; --card-bg: #ffffff; --border: #e2e8f0; }
        .dark { --background: #020617; --foreground: #f8fafc; --card-bg: #0f172a; --border: #1e293b; }
        body { font-family: 'Inter', sans-serif; background-color: var(--background); color: var(--foreground); height: 100vh; overflow: hidden; }
        .screen { padding: 4rem 1rem 6rem; height: 100vh; overflow-y: auto; }
        .card { background-color: var(--card-bg); border: 1px solid var(--border); }
        .sub-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 50; transform: translateX(100%); transition: transform 0.3s; background: var(--background); overflow-y: auto; padding-top: 5rem; }
        .sub-screen.active { transform: translateX(0); }
        .markdown-body ul { list-style: disc; padding-left: 1.5rem; }
        .option-btn { cursor: pointer; user-select: none; }
        .option-btn:active { transform: scale(0.98); }
    </style>
</head>
<body class="antialiased">

    <script>
        // ======================================================
        // DATABASE: PASTE YOUR QUESTIONS HERE INSIDE THE LISTS
        // ======================================================
        window.quizData = {
            
            "Aquaculture": [
                { q: "Recommended slope for clay soil dike?", opts: ["1:1", "2:1", "1:2", "1:4"], a: "2:1" },
                { q: "Calculate FCR: 1500kg feed / 1200kg fish.", opts: ["0.8", "1.25", "1.5", "1.2"], a: "1.25" },
                { q: "Primary toxic metabolite in RAS?", opts: ["Nitrate", "Ammonia", "Nitrite", "CO2"], a: "Ammonia" },
                { q: "Scientific name of Milkfish?", opts: ["Chanos chanos", "Oreochromis niloticus", "Lates calcarifer", "Mugil cephalus"], a: "Chanos chanos" },
                { q: "Main purpose of liming ponds?", opts: ["Disinfect", "Increase Alkalinity/pH", "Kill predators", "Fertilize"], a: "Increase Alkalinity/pH" }
                // PASTE MORE AQUACULTURE QUESTIONS HERE (Make sure to use commas!)
            ],

            "Capture Fisheries": [
                { q: "Which is an Active Gear?", opts: ["Gill net", "Fish pot", "Trawl", "Longline"], a: "Trawl" },
                { q: "Municipal waters distance?", opts: ["7km", "10km", "15km", "20km"], a: "15km" },
                { q: "Starboard refers to?", opts: ["Left", "Right", "Rear", "Front"], a: "Right" },
                { q: "Mesh size is measured by?", opts: ["Knot to knot (stretched)", "Diagonal", "Area", "Diameter"], a: "Knot to knot (stretched)" }
                // PASTE MORE CAPTURE QUESTIONS HERE
            ],

            "Ecology & Resources": [
                { q: "Sharp density gradient in water?", opts: ["Halocline", "Thermocline", "Pycnocline", "Chemocline"], a: "Pycnocline" },
                { q: "Cause of Paralytic Shellfish Poisoning?", opts: ["Sargassum", "Pyrodinium", "Caulerpa", "Kappaphycus"], a: "Pyrodinium" },
                { q: "Mangrove aerial roots?", opts: ["Pneumatophores", "Prop roots", "Buttress", "Stilt"], a: "Pneumatophores" }
                // PASTE MORE ECOLOGY QUESTIONS HERE
            ],

            "Post-Harvest": [
                { q: "Primary concern in canned products?", opts: ["Salmonella", "E. coli", "C. botulinum", "Vibrio"], a: "C. botulinum" },
                { q: "Stiffening of fish muscle after death?", opts: ["Autolysis", "Rigor Mortis", "Putrefaction", "Oxidation"], a: "Rigor Mortis" },
                { q: "Histamine poisoning fish family?", opts: ["Scombridae", "Cichlidae", "Cyprinidae", "Serranidae"], a: "Scombridae" }
                // PASTE MORE POST-HARVEST QUESTIONS HERE
            ],

            "Mock Exam": [] // Leave empty, fills automatically
        };
    </script>
    <header class="fixed top-0 w-full h-16 flex items-center justify-center border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-slate-900 z-40">
        <h1 class="font-bold text-lg text-blue-600">LCP Reviewer</h1>
    </header>

    <main>
        <div id="login-screen" class="screen flex flex-col items-center justify-center z-50 absolute inset-0 bg-white dark:bg-slate-950">
            <div class="card p-8 rounded-2xl shadow-xl w-full max-w-sm text-center">
                <div class="mb-6"><span class="text-4xl">üë®‚Äçüéì</span><h2 class="text-2xl font-bold mt-4">Fisheries Reviewer</h2></div>
                <input type="text" id="username-input" class="w-full p-4 border rounded-xl mb-4 bg-transparent" placeholder="Enter Name">
                <button onclick="handleLogin()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-xl shadow-lg">Start</button>
            </div>
        </div>

        <div id="home-screen" class="screen hidden">
             <div class="mb-6"><h2 class="text-2xl font-bold">Hi, <span id="user-greeting" class="text-blue-600">Student</span>!</h2></div>
             <div class="grid grid-cols-2 gap-4">
                <div class="card p-4 rounded-xl text-center shadow-sm"><p class="text-xs text-gray-500 uppercase">Mastery</p><p id="home-avg" class="text-3xl font-black text-blue-600">0%</p></div>
                <div class="card p-4 rounded-xl text-center shadow-sm"><p class="text-xs text-gray-500 uppercase">Quizzes</p><p id="home-count" class="text-3xl font-black text-blue-600">0</p></div>
                
                <div onclick="openSetup('Aquaculture')" class="card p-4 rounded-xl shadow-sm cursor-pointer border-l-4 border-blue-400 hover:bg-gray-50"><h3 class="font-bold">üêü Aquaculture</h3></div>
                <div onclick="openSetup('Capture Fisheries')" class="card p-4 rounded-xl shadow-sm cursor-pointer border-l-4 border-teal-400 hover:bg-gray-50"><h3 class="font-bold">‚öì Capture</h3></div>
                <div onclick="openSetup('Ecology & Resources')" class="card p-4 rounded-xl shadow-sm cursor-pointer border-l-4 border-green-400 hover:bg-gray-50"><h3 class="font-bold">üå± Ecology</h3></div>
                <div onclick="openSetup('Post-Harvest')" class="card p-4 rounded-xl shadow-sm cursor-pointer border-l-4 border-orange-400 hover:bg-gray-50"><h3 class="font-bold">ü•´ Post-Harvest</h3></div>
                
                <div onclick="openSetup('Mock Exam')" class="col-span-2 card p-6 rounded-xl bg-blue-600 text-white shadow-lg cursor-pointer flex justify-between items-center">
                    <div><h3 class="font-bold text-xl">üìö Mock Exam</h3><p class="text-sm opacity-90">Mixed subjects</p></div><span class="text-2xl">‚ûî</span>
                </div>
             </div>
        </div>

        <div id="setup-screen" class="sub-screen p-6 flex flex-col items-center justify-center text-center">
            <h2 id="setup-subject" class="text-2xl font-bold text-blue-600 mb-6">Subject</h2>
            <div class="w-full max-w-sm space-y-3">
                <button onclick="startQuiz(10)" class="w-full py-4 border-2 border-blue-100 hover:border-blue-500 rounded-xl font-bold">10 Questions</button>
                <button onclick="startQuiz(25)" class="w-full py-4 border-2 border-blue-100 hover:border-blue-500 rounded-xl font-bold">25 Questions</button>
                <button onclick="closeSubScreen()" class="mt-6 text-gray-500">Cancel</button>
            </div>
        </div>

        <div id="quiz-screen" class="sub-screen p-4">
            <div class="max-w-2xl mx-auto">
                <div class="flex justify-between text-sm font-bold mb-2 text-gray-500"><span id="quiz-lbl">Subject</span><span><span id="q-curr">1</span>/<span id="q-total">10</span></span></div>
                <div class="h-2 bg-gray-200 rounded-full mb-6"><div id="progress" class="h-2 bg-blue-600 rounded-full w-0 transition-all"></div></div>
                <div id="q-text" class="text-lg font-medium mb-6 leading-relaxed">Loading...</div>
                <div id="options" class="space-y-3"></div>
                <div id="quiz-controls" class="hidden mt-8 flex justify-between">
                    <button onclick="finishQuiz()" class="text-red-500 font-bold">End</button>
                    <button onclick="nextQuestion()" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold shadow-lg">Next ‚ûú</button>
                </div>
            </div>
        </div>

        <div id="result-screen" class="sub-screen p-6 flex flex-col items-center justify-center text-center">
            <div class="card p-8 rounded-2xl shadow-xl w-full max-w-md">
                <h2 class="text-2xl font-bold mb-2">Result</h2>
                <div id="final-score" class="text-6xl font-black text-blue-600 mb-4">0%</div>
                <button onclick="closeSubScreen()" class="w-full py-3 bg-gray-100 rounded-lg font-bold mb-2">Done</button>
            </div>
        </div>
    </main>

    <script>
        // State Variables
        let currentQuiz = [];
        let qIndex = 0;
        let score = 0;
        let activeSubject = "";
        let currentUser = localStorage.getItem('username');

        // Initialization
        if (currentUser) {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('user-greeting').textContent = currentUser;
            updateStats();
        }

        function handleLogin() {
            const name = document.getElementById('username-input').value.trim();
            if (!name) return alert("Enter name");
            currentUser = name;
            localStorage.setItem('username', name);
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('home-screen').classList.remove('hidden');
            document.getElementById('user-greeting').textContent = currentUser;
        }

        function openSetup(sub) {
            activeSubject = sub;
            document.getElementById('setup-subject').textContent = sub;
            document.getElementById('setup-screen').classList.add('active');
        }

        function closeSubScreen() {
            document.querySelectorAll('.sub-screen').forEach(s => s.classList.remove('active'));
            updateStats();
        }

        function startQuiz(count) {
            let pool = [];
            if (activeSubject === "Mock Exam") {
                Object.values(window.quizData).forEach(arr => pool.push(...arr));
            } else {
                pool = window.quizData[activeSubject];
            }

            // SAFETY CHECK
            if (!pool || pool.length === 0) {
                alert("No questions found for " + activeSubject + ". Please add questions in the script tag.");
                return;
            }

            // Shuffle
            pool = [...pool].sort(() => 0.5 - Math.random());
            currentQuiz = pool.slice(0, count);
            qIndex = 0;
            score = 0;

            // Update UI
            document.getElementById('q-total').textContent = currentQuiz.length;
            document.getElementById('quiz-lbl').textContent = activeSubject;
            document.getElementById('setup-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');
            
            loadQuestion();
        }

        function loadQuestion() {
            const q = currentQuiz[qIndex];
            document.getElementById('q-curr').textContent = qIndex + 1;
            document.getElementById('progress').style.width = `${((qIndex)/currentQuiz.length)*100}%`;
            document.getElementById('q-text').textContent = q.q;
            
            const optsContainer = document.getElementById('options');
            optsContainer.innerHTML = '';
            document.getElementById('quiz-controls').classList.add('hidden');
            document.getElementById('quiz-controls').classList.remove('flex');

            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn w-full text-left p-4 card rounded-lg hover:bg-blue-50 transition border-2 border-transparent";
                btn.textContent = opt;
                // CRITICAL: Explicit click handler
                btn.onclick = function() { checkAnswer(this, opt, q.a); };
                optsContainer.appendChild(btn);
            });
        }

        function checkAnswer(btn, selected, correct) {
            // Prevent double clicking by checking if controls are visible
            if (!document.getElementById('quiz-controls').classList.contains('hidden')) return;

            const allBtns = document.querySelectorAll('.option-btn');
            
            if (selected === correct) {
                score++;
                btn.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                btn.classList.remove('border-transparent');
            } else {
                btn.classList.add('bg-red-100', 'border-red-500', 'text-red-800');
                btn.classList.remove('border-transparent');
                
                // Highlight correct one
                allBtns.forEach(b => {
                    if (b.textContent === correct) {
                        b.classList.add('bg-green-100', 'border-green-500', 'text-green-800');
                        b.classList.remove('border-transparent');
                    }
                });
            }

            document.getElementById('quiz-controls').classList.remove('hidden');
            document.getElementById('quiz-controls').classList.add('flex');
        }

        function nextQuestion() {
            qIndex++;
            if (qIndex < currentQuiz.length) {
                loadQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            const pct = Math.round((score / currentQuiz.length) * 100);
            
            // Save Stats
            let stats = JSON.parse(localStorage.getItem('fisheriesStats')) || { count: 0, totalScore: 0 };
            stats.count++;
            stats.totalScore += pct;
            localStorage.setItem('fisheriesStats', JSON.stringify(stats));

            document.getElementById('final-score').textContent = pct + "%";
            document.getElementById('quiz-screen').classList.remove('active');
            document.getElementById('result-screen').classList.add('active');
        }

        function updateStats() {
            let stats = JSON.parse(localStorage.getItem('fisheriesStats')) || { count: 0, totalScore: 0 };
            document.getElementById('home-count').textContent = stats.count;
            const avg = stats.count ? Math.round(stats.totalScore / stats.count) : 0;
            document.getElementById('home-avg').textContent = avg + "%";
        }
    </script>
</body>
</html>
